<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale-1.0">
    <meta name="author" content="Grupo 1 - DDS 2023 - K3003">

    <title>SMESTPE - Incidencias</title>
    <link rel="icon"
          href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='orange' class='fa-solid fa-1' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2zm7.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383z'/%3E%3C/svg%3E"
          sizes="any" type="image/svg+xml">
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="icon" viewBox="0 0 16 16">
            <path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2Zm7.283 4.002V12H7.971V5.338h-.065L6.072 6.656V5.385l1.899-1.383h1.312Z"/>
        </symbol>
        <symbol id="home" viewBox="0 0 16 16">
            <path d="M8.354 1.146a.5.5 0 0 0-.708 0l-6 6A.5.5 0 0 0 1.5 7.5v7a.5.5 0 0 0 .5.5h4.5a.5.5 0 0 0 .5-.5v-4h2v4a.5.5 0 0 0 .5.5H14a.5.5 0 0 0 .5-.5v-7a.5.5 0 0 0-.146-.354L13 5.793V2.5a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0-.5.5v1.293L8.354 1.146zM2.5 14V7.707l5.5-5.5 5.5 5.5V14H10v-4a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 0-.5.5v4H2.5z"/>
        </symbol>
        <symbol id="speedometer2" viewBox="0 0 16 16">
            <path d="M8 4a.5.5 0 0 1 .5.5V6a.5.5 0 0 1-1 0V4.5A.5.5 0 0 1 8 4zM3.732 5.732a.5.5 0 0 1 .707 0l.915.914a.5.5 0 1 1-.708.708l-.914-.915a.5.5 0 0 1 0-.707zM2 10a.5.5 0 0 1 .5-.5h1.586a.5.5 0 0 1 0 1H2.5A.5.5 0 0 1 2 10zm9.5 0a.5.5 0 0 1 .5-.5h1.5a.5.5 0 0 1 0 1H12a.5.5 0 0 1-.5-.5zm.754-4.246a.389.389 0 0 0-.527-.02L7.547 9.31a.91.91 0 1 0 1.302 1.258l3.434-4.297a.389.389 0 0 0-.029-.518z"/>
            <path fill-rule="evenodd"
                  d="M0 10a8 8 0 1 1 15.547 2.661c-.442 1.253-1.845 1.602-2.932 1.25C11.309 13.488 9.475 13 8 13c-1.474 0-3.31.488-4.615.911-1.087.352-2.49.003-2.932-1.25A7.988 7.988 0 0 1 0 10zm8-7a7 7 0 0 0-6.603 9.329c.203.575.923.876 1.68.63C4.397 12.533 6.358 12 8 12s3.604.532 4.923.96c.757.245 1.477-.056 1.68-.631A7 7 0 0 0 8 3z"/>
        </symbol>
        <symbol id="table" viewBox="0 0 16 16">
            <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z"/>
        </symbol>
        <symbol id="people-circle" viewBox="0 0 16 16">
            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
            <path fill-rule="evenodd"
                  d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z"/>
        </symbol>
        <symbol id="grid" viewBox="0 0 16 16">
            <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5v-3zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5v-3zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
        </symbol>
    </svg>

    <!-- Bootstrap core CSS / SUPER CRITICO -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <style>
        /* GLOBAL STYLES */
body {
  padding-top: 2.3rem;


  /* RESPONSIVE CSS */
  @media (min-width: 40em) {

      .featurette-heading {
          font-size: 50px;
      }
  }


  /* MARKETING CONTENT */
  .marketing .col-lg-4 {
      margin-bottom: 1.5rem;
      text-align: center;
  }

  .marketing h2 {
      font-weight: 400;
  }

  .marketing .col-lg-4 p {
      margin-right: .75rem;
      margin-left: .75rem;
  }

  /* Featurettes */
  .featurette-divider {
      margin-top: 1rem;
  }

  .featurette-heading {
      font-weight: 300;
      line-height: 1;
  }

  /* RESPONSIVE CSS */
  @media (min-width: 40em) {

  /* Botones */
  .btn-secondary,
  .btn-secondary:hover,
  .btn-secondary:focus {
      color: #333;
      text-shadow: none; /* Prevent inheritance from `body` */
  }

  /* Base structure */
  .cover-container {
      max-width: 42em;
  }

  /* Header */
  .nav-masthead .nav-link {
      padding: .25rem 0;
      font-weight: 700;
      color: rgba(255, 255, 255, .5);
      background-color: transparent;
      border-bottom: .25rem solid transparent;
  }

  .nav-masthead .nav-link:hover,
  .nav-masthead .nav-link:focus {
      border-bottom-color: rgba(255, 255, 255, .25);
  }

  .nav-masthead .nav-link + .nav-link {
      margin-left: 1rem;
  }

  .nav-masthead .active {
      color: #fff;
      border-bottom-color: #fff;
  }
}
    </style>
</head>

<tbody>
    <nav class="navbar navbar-expand-lg fixed-top navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">
            <svg class="bi me-2" width="40" height="32" role="img" style="fill: orange;">
                <use xlink:href="#icon"/>
            </svg>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
                aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/">Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Incidencias</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/ui/incidents/inaccessible_accessibility_features">Medidas de Accesibilidad</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/ui/incidents/upload_csv">Cargar</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/faqs">FAQs</a>
                </li>
            </ul>
            <form class="d-flex">
                <a type="button" href="/ui/incidents/login" class="btn me-2 btn-outline-light">Ingresar</a>
                <a type="button" href="/error" class="btn me-2 btn-warning">Registrarse</a>
            </form>
        </div>
    </div>
</nav>

    <div class="container">
        <div class="row justify-content-between pt-5">
            <div class="col-15 d-flex justify-content-between">
                <h2 style="display: inline;">Historial de incidencias</h2>
                <a type="button" class="btn me-2 btn-primary" href="/ui/incidents/new">Crear nueva incidencia</a>
            </div>
            <hr class="featurette-divider">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th scope="col">Id</th>
                    <th scope="col">Código</th>
                    <th scope="col">Fecha</th>
                    <th scope="col">Descripcion</th>
                    <th scope="col">Reportó</th>
                    <th scope="col">Acciones</th>
                </tr>
                </thead>
                <tbody id= "tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <ul id="incidentList"></ul>

    <div id="pagination">
        <button id="previousPageButton">Previous</button>
        <span id="currentPageSpan">Page 1 of {{totalPages}}</span>
        <button id="nextPageButton">Next</button>
    </div>

    <script>
        if (!document.cookie.split(";").some((item) => item.trim().startsWith("auth="))) window.location.href = "/ui/incidents/login";

        var pageSize = {{pageSize}};
        var tableBody = document.getElementById('tableBody');
        var previousPageButton = document.getElementById('previousPageButton');
        var nextPageButton = document.getElementById('nextPageButton');
        var currentPage = 1;
        var totalPages = {{totalPages}}; // Asegúrate de obtener el valor correcto desde el servidor

        function updateCurrentPageSpan() {
            var currentPageSpan = document.getElementById('currentPageSpan');
            currentPageSpan.textContent = `Page ${currentPage} of ${totalPages}`;
        }

        function loadIncidents(page) {
            var startIndex = (page - 1) * pageSize;
            var url = `/api/incidents?page=${page}&pageSize=${pageSize}`;

            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    tableBody.innerHTML = '';

                    data.forEach(incident => {
                        var trItem = document.createElement('tr');
                        trItem.innerHTML = `
                            <td scope="row">${incident.id}</td>
                            <td>${incident.catalogCode}</td>
                            <td>${incident.reportDate}</td>
                            <td>${incident.description}</td>
                            <td>${incident.reportedBy}</td>
                            <td>${incident.state}</td>
                            <td>
                                <div class="d-flex justify-content-around">
                                    <a href="/ui/incidents/${incident.id}" class="text-decoration-none">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-eye" viewBox="0 0 16 16">
                                            <path d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"/>
                                            <path d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"/>
                                        </svg>
                                    </a>
                                    <a href="/ui/incidents/edit/${incident.id}" class="text-decoration-none">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="bi bi-pencil" viewBox="0 0 16 16">
                                            <path d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"/>
                                        </svg>
                                    </a>
                                </div>
                            </td>
                        `;
                        tableBody.appendChild(trItem);
                    });

                    updateCurrentPageSpan();
                })
                .catch(error => console.error('Error:', error));
        }

        if (previousPageButton) {
            previousPageButton.addEventListener('click', function () {
                if (currentPage > 1) {
                    currentPage--;
                    loadIncidents(currentPage);
                }
            });
        }

        if (nextPageButton) {
            nextPageButton.addEventListener('click', function () {
                if (currentPage < totalPages) {
                    currentPage++;
                    loadIncidents(currentPage);
                }
            });
        }

        loadIncidents(currentPage);
    </script>

</body>

</html>
